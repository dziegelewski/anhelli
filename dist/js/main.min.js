'use strict';

var Man = function Man(height, width, speed) {
	var color = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : VAR.randRGB(0, 90);
	var direction = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;

	this.height = height;
	this.width = width;
	this.speed = speed;
	this.color = color;
	this.direction = direction;
	this.that = this;
	this.born = function (x) {
		var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : VAR.H - VAR.groundThickness;

		living.push(this);
		this.x = x;
		this.y = y - this.height;
	};
	this.render = function () {
		ctx.fillStyle = this.color;
		ctx.fillRect(this.x, this.y, this.width, this.height);
	};
	this.move = function () {
		if (this.x >= VAR.W - this.width - this.speed / 2 && this.direction === 1 || this.x <= this.speed / 2 && this.direction === -1) {
			this.direction *= -1;
		}
		this.x += this.speed * this.direction;
	};
};
var VAR = {
	fps: 60,
	W: 900,
	H: 600,
	rand: function rand(min, max) {
		return Math.floor(Math.random() * max) + min;
	},
	randRGB: function randRGB() {
		var darkest = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
		var brightest = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 255;

		return 'rgb(' + VAR.rand(darkest, brightest) + ',' + VAR.rand(darkest, brightest) + ',' + VAR.rand(darkest, brightest) + ')';
	},
	groundThickness: 50,
	groundColor: 'black'
};

var living = [];

var canvas = document.createElement('canvas');
canvas.width = VAR.W;
canvas.height = VAR.H;
var ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

var Hero = new Man(60, 20, 13, 'lightseagreen');
Hero.keyUse = function (e) {
	if (e.which === 37 || e.which === 39) {
		e.preventDefault();
		Hero['key_' + e.which] = e.type === 'keydown' ? true : false;
	}
};
Hero.move = function () {
	if (this.key_37 === true) {
		if (this.x <= this.speed / 2) {
			return false;
		}
		this.x -= this.speed;
	}
	if (this.key_39 === true) {
		if (this.x >= VAR.W - this.width - this.speed / 2) {
			return false;
		}
		this.x += this.speed;
	}
};

Hero.born(VAR.rand(0, VAR.W));

var monsters = 3,
    mns = [];

for (var i = 0; i < monsters; i++) {
	var strength = VAR.rand(0, 6) + 9;
	mns[i] = new Man(strength * 10, strength * 4, Math.floor(strength / 2));
	mns[i].born(VAR.rand(0, VAR.W));
}

var drawGround = function drawGround() {
	var horizontal = VAR.H - VAR.groundThickness;
	ctx.beginPath();
	ctx.moveTo(0, horizontal);
	ctx.lineTo(VAR.W, horizontal);
	ctx.strokeStyle = VAR.groundColor;
	ctx.lineWidth = 3;
	ctx.stroke();
};

var animationLoop = function animationLoop() {
	ctx.clearRect(0, 0, VAR.W, VAR.H);
	requestAnimationFrame(animationLoop);
	for (var i = 0, length = living.length; i < length; i++) {
		living[i].move();
		living[i].render();
	}
	drawGround();
};
animationLoop();

var init = function init() {
	window.addEventListener('keydown', Hero.keyUse, false);
	window.addEventListener('keyup', Hero.keyUse, false);
};
init();